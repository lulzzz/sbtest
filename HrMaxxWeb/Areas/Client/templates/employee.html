<div class="row">
	<div class="col-sm-12 alert alert-{{alert.type}}" ng-show="alert">
		{{alert.message}}
	</div>

	<div class="panel-group col-sm-12" id="accordion">

		<div class="panel panel-inverse overflow-hidden">
			<div class="panel-heading">
				<i class="fa fa-plus-circle pull-right"></i>
				<ul class="nav nav-tabs pull-right" id="companytabs">
					<li ng-class="{'active':tab!==6}" ng-click="tab=1"><a data-toggle="tab"><i class="fa fa-info"></i> <span class="hidden-xs">Info</span></a></li>
					<li ng-class="{'active':tab===6}" ng-show=" selected.id && showControls && (mainData.userRole==='SuperUser' || mainData.userRole==='Master')" ng-click="tab=6"><a data-toggle="tab"><i class="fa fa-list"></i> <span class="hidden-xs">Versions</span></a></li>
				</ul>
				<h3 class="panel-title">
					<a class="accordion-toggle accordion-toggle-styled" data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne">
						Employee Details - {{selected.name}}
					</a>
				</h3>
			</div>
			<div id="collapseOne" class="panel-collapse collapse in  tab-content">
				<div class="tab-pane fade in" id="info" ng-class="{'active':tab!==6}">
					<form data-parsley-validate="true" name="employee">
						<div id="wizard">
							<ol>
								<li>
									Information
									<small>Name, Address etc</small>
								</li>
								<li>
									Payroll
									<small>Payroll processing details</small>
								</li>
								<li>
									Taxation
									<small>Taxation Address and Federal and State details</small>
								</li>
							</ol>
							<!-- begin wizard step-1 -->
							<div class="wizard-step-1">
								<fieldset>
									<legend class="width-full">Contact</legend>
									<!-- begin row -->
									<div class="row">
										<contact data="selected.contact" sourcetypeid="data.sourceTypeId" sourceid="selected.id" type="0" val-group="'wizard-step-1'" show-primary="false" />
									</div>
									<div class="row">
										<div class="col-sm-4">
											<div class="form-group">
												<label>Gender</label>
												<select ng-model="selected.gender" name="gender" class="form-control" convert-to-number required data-parsley-group="wizard-step-1" data-parsley-type="number">
													<option value="0">NA</option>
													<option value="1">Male</option>
													<option value="2">Female</option>
												</select>
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>SSN <button class="btn btn-info btn-sm" ng-disabled="!selected.ssn" ng-click="checkSSN()"><i class="fa fa-eye"></i></button></label>
												<input type="text" name="ssn" class="form-control" ng-model="selected.ssn" ui-mask="899-99-9999" required data-parsley-group="wizard-step-1" />
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label class="control-label">Birth Date</label>
												<date-ctrl name="birthdate" required="false" model="selected.birthDate" disabled="false" />

											</div>
										</div>
									</div>
								</fieldset>
								<fieldset>
									<legend class="width-full">Employment</legend>
									<!-- begin row -->

									<div class="row">
										<div class="col-sm-2">
											<div class="form-group">
												<label class="control-label">Hire Date</label>
												<date-ctrl name="'hiredate'" required="true" model="selected.hireDate" disabled="false" />

											</div>
										</div>
										<div class="col-sm-2">
											<div class="form-group">
												<label class="control-label">Sick Leave Hire Date</label>
												<date-ctrl name="'sickleavehiredate'" required="true" model="selected.sickLeaveHireDate" disabled="false" />

											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Department</label>
												<input type="text" name="deartment" placeholder="Department" class="form-control" ng-model="selected.department" />
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Status</label>
												<select ng-model="selected.statusId" name="status" class="form-control" convert-to-number>
													<option value="1">Active</option>
													<option value="2">InActive</option>
													<option value="3">Terminated</option>
												</select>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-4">
											<div class="form-group" ng-hide="!selected.id">
												<label>SL Carry Over</label>
												<input type="text" name="slco" placeholder="Carry Over" class="form-control" ng-model="selected.carryOver" data-parsley-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" data-parsley-type="number" convert-to-decimal />
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Memo</label>
												<input type="text" name="memo" placeholder="memo" class="form-control" ng-model="selected.memo" />
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>W/C Job Class </label>
												<select class="form-control" ng-model="selected.workerCompensation" ng-options="wc.code + '-' + wc.description for wc in mainData.selectedCompany.workerCompensations | orderBy:'id' track by wc.id" data-parsley-group="wizard-step-1" ng-required="mainData.selectedCompany.workerCompensations.length>0">
													<option value="">Please select...</option>
												</select>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-4">
											<div class="form-group" ng-hide="!selected.id">
												<label>Employee No</label>
												<input type="text" name="empno" placeholder="Employee No" class="form-control" ng-model="selected.employeeNo" ng-disabled="true" />
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group" >
												<label>Employee No (Company)</label>
												<input type="text" name="empno1" placeholder="Employee No" class="form-control" ng-model="selected.companyEmployeeNo" />
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Internal Notes</label>
												<input type="text" name="memo" placeholder="notes" class="form-control" ng-model="selected.notes" />
											</div>
										</div>
									</div>
								</fieldset>
							</div>
							<!-- end wizard step-1 -->
							<!-- begin wizard step-2 -->
							<div class="wizard-step-2">
								<fieldset>
									<legend class="width-full">Payroll</legend>
									<!-- begin row -->
									<div class="row" style="min-height:300px">
										<!-- begin col-6 -->
										<div class="col-sm-4">
											<div class="form-group">
												<label>Payroll Schedule</label>
												<select ng-model="selected.payrollSchedule" name="scheuled" class="form-control" data-parsley-group="wizard-step-2" required convert-to-number data-parsley-type="number">
													<option value="1">Weekly</option>
													<option value="2">Bi-Weekly</option>
													<option value="3">Semi-Monthly</option>
													<option value="4">Monthly</option>

												</select>
											</div>
											<div class="form-group">
												<label for="comps">Recurring Compensation(s)</label><i class="fa fa-plus-circle fa-lg" ng-show="availablePayTypes().length>0" ng-click="addPayType()"></i>
												<div class="col-sm-12" ng-show="selected.compensations.length>0" ng-if="selected.compensations">
													<table class="table table-header table-bordered table-condensed form-controls input-sm">
														<thead>
															<tr>
																<td class="col-sm-6">Pay Type</td>
																<td class="col-sm-4">Amount</td>
																<td class="col-sm-2"></td>

															</tr>
														</thead>
														<tbody>
															<tr ng-repeat="item in selected.compensations track by $index">
																<td>
																	<select name="pt1{{$index}}" id="pt1{{$index}}" class="form-control" ng-change="updatePayTypeUsed(item)" ng-model="item.payType" ng-disabled="!item.isNew" ng-options="st.description for st in payTypeList(item) | orderBy:'id' track by st.id" required data-parsley-group="wizard-step-3">
																		<option value="">Please select...</option>
																	</select>
																</td>
																<td>
																	<input name="a1{{$index}}" id="at1{{$index}}" type="number" ng-model="item.amount" class="form-control" required data-parsley-group="wizard-step-3" data-parsley-type="number" data-parsley-min="0" />
																</td>
																<td>
																	<i class="fa fa-remove fa-lg" ng-click="cancel1($index)"></i>
																</td>
															</tr>
														</tbody>
													</table>




												</div>

											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Pay Type</label>
												<select ng-model="selected.payType" name="paytype" class="form-control" ng-change="payTypeChanged()" convert-to-number required data-parsley-group="wizard-step-2" data-parsley-type="number">
													<option value="1">Hourly</option>
													<option value="2">Salary</option>
													<option value="3">Piece-work</option>
													<option value="4">Job Cost</option>
												</select>
											</div>
											<div class="form-group">
												<label>Payment Method</label>
												<select ng-model="selected.paymentMethod" name="method" class="form-control" data-parsley-group="wizard-step-2" required convert-to-number data-parsley-type="number">
													<option value="1">Check</option>
													<option value="2" ng-show="mainData.selectedCompany.directDebitPayer">Direct Deposit</option>

												</select>
											</div>
											<div class="row" ng-if="selected.paymentMethod===2">
												<div class="form-group">
													<label></label>
													<div>
														<label for="ddauth" class="switch">
															DD Authorization availble with company?
															<input id="ddauth" type="checkbox" ng-model="selected.directDebitAuthorized" /><i></i>
														</label>
													</div>
												</div>
												<div class="col-sm-12">
													<table class="table table-header table-bordered table-condensed form-controls input-sm">
														<thead>
															<tr>
																<td class="col-sm-7">Bank Details</td>
																<td class="col-sm-3">%age</td>
																<td class="col-sm-2"></td>
															</tr>
														</thead>
														<tbody>
															<tr ng-repeat="bank in selected.bankAccounts track by $index">
																<td>
																	<span ng-show="!selectedBank || selectedBankIndex!==$index">
																		{{ bank.bankAccount? bank.bankAccount.bankName : '' }}
																	</span>
																	<div class="row" ng-if="selectedBank && selectedBankIndex===$index">
																		<div class="form-group">
																			<label>Bank Name</label>
																			<input type="text" required ng-model="selectedBank.bankAccount.bankName" class="form-control" />
																		</div>

																		<div class="form-group">
																			<label>Account type</label>
																			<div>
																				<select ng-model="selectedBank.bankAccount.accountType" name="accountType" class="form-control" convert-to-number>
																					<option value="1">Checking</option>
																					<option value="2">Savings</option>

																				</select>

																			</div>

																		</div>
																		<div class="form-group">
																			<label>Routing Number</label>
																			<div>
																				<input type="text" class="form-control" ng-pattern="/^[0-9]{9}$/" name="routingnumber" ui-mask="999999999" ng-model="selectedBank.bankAccount.routingNumber" ng-class="{'has-error':!validateRoutingNumber(selectedBank.bankAccount.routingNumber)}" />

																			</div>
																		</div>
																		<div class="form-group">
																			<label>Account Number</label>
																			<div>
																				<input type="text" class="form-control" placeholder="Account Number between 8-17 numbers" name="accountnumber" ng-model="selectedBank.bankAccount.accountNumber" ng-pattern="/^\d{8,17}$/" />

																			</div>
																		</div>
																		<div class="form-group">
																			<label>Fraction Id</label>
																			<div>
																				<input type="text" class="form-control" placeholder="Fraction Id" name="accountnumber" ng-model="selectedBank.bankAccount.fractionId" />

																			</div>
																		</div>
																	</div>
																</td>
																<td>
																	<!-- editable comment (text with validation) -->
																	<span ng-show="!selectedBank || selectedBankIndex!==$index">
																		{{ bank.percentage | currency }}%
																	</span>
																	<input type="number" class="form-control" ng-model="selectedBank.percentage" ng-show="selectedBank && selectedBankIndex===$index" step="0.01" ng-max="100" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" />
																</td>

																<td style="white-space: nowrap">
																	<!-- form -->

																	<button type="button" ng-show="!selectedBank || selectedBankIndex!==$index" class="btn btn-primary btn-xs" ng-click="setSelectedBank($index)">
																		<i class="fa fa-edit m-r-5"></i> edit
																	</button>
																	<button type="button" ng-show="!selectedBank || selectedBankIndex!==$index" class="btn btn-danger btn-xs" ng-click="delete($index)">
																		<i class="fa fa-recycle m-r-5"></i> delete
																	</button>
																	<button type="button" ng-disabled="!isbankValid()" ng-show="selectedBank && selectedBankIndex===$index" ng-click="saveBank()" ng class="btn btn-success btn-xs">
																		<i class="fa fa-save m-r-5"></i> enter
																	</button>
																	<button type="button" ng-show="selectedBank && selectedBankIndex===$index" ng-click="cancelBank($index)" class="btn btn-default btn-xs">
																		<i class="fa fa-remove m-r-5"></i> cancel
																	</button>

																</td>

															</tr>
															<tr ng-show="!selectedBank">
																<td colspan="2">
																	<span ng-show="selected.bankAccounts.length===0">No Banks set up</span>
																</td>

																<td>
																	<button type="button" ng-click="addBankAccount()" ng-show="ddPercentageAvailable()>0" class="btn btn-primary">
																		Add
																	</button>
																</td>
															</tr>

														</tbody>
													</table>
												</div>

											</div>

										</div>

										<div class="col-sm-4" ng-if="selected.payType">
											<div class="form-group" ng-if="selected.payType!==3">
												<label>{{selected.payType===1 ? 'Base Hourly Rate' : 'Salary $'}}</label>
												<input id="rate" class="form-control" ng-model="selected.rate" required data-parsley-group="wizard-step-2" style="width:10em;" data-parsley-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" data-parsley-trigger="blur" step="0.01" data-parsley-min="0" />{{selected.payType===1? ' per hour' : ' per pay schedule'}}

											</div>

											<div class="form-group" ng-if="selected.payType===1">
												<label for="paycodes">Pay Code(s)</label>
												<div ng-dropdown-multiselect="" options="data.payCodes" extra-settings="{displayProp: 'dropDownDisplay', idProp: 'id', showCheckAll: true, showUncheckAll: true ,scrollable: true, scrollableHeight: 220, buttonClasses:'btn btn-sm btn-default'}" selected-model="selectedPayCodes" events="payCodeEvents" required data-parsley-group="wizard-step-2"></div>

											</div>

										</div>

									</div>

									<!-- end row -->
								</fieldset>
							</div>
							<!-- end wizard step-2 -->
							<!-- begin wizard step-3 -->
							<div class="wizard-step-3">
								<fieldset>
									<legend class="width-full">Taxation</legend>
									<!-- begin row -->
									<div class="row">
										<div class="col-sm-4">
											<div class="form-group">
												<label>Tax Status</label>
												<select ng-model="selected.taxCategory" name="category" class="form-control" required data-parsley-group="wizard-step-3" convert-to-number data-parsley-type="number">
													<option value="1">US Worker non-visa</option>
													<option value="2">Non Immigrant Alien (H1, F1, J1,)</option>
													<option value="3">Clergy (only FIT & SIT)</option>
												</select>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-4">
											<div class="form-group">
												<label>Federal Filing Status</label>
												<select ng-model="selected.federalStatus" name="fstatus" class="form-control" required data-parsley-group="wizard-step-3" convert-to-number data-parsley-type="number">
													<option value="1">Single</option>
													<option value="2">Married</option>
													<option value="3">Unmarried Head of Household</option>
												</select>
											</div>

										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Federal Exemptions</label>
												<select ng-model="selected.federalExemptions" name="fstatus" class="form-control" required data-parsley-group="wizard-step-3" convert-to-number data-parsley-type="number">
													<option value="0">0</option>
													<option value="1">1</option>
													<option value="2">2</option>
													<option value="3">3</option>
													<option value="4">4</option>
													<option value="5">5</option>
													<option value="6">6</option>
													<option value="7">7</option>
													<option value="8">8</option>
													<option value="9">9</option>
													<option value="10">10 or more</option>
												</select>
											</div>
										</div>
										<div class="col-sm-4">
											<div class="form-group">
												<label>Federal Additional Amout</label>
												<input name="faddamount" placeholder="Federal Additional Amount" class="form-control" ng-model="selected.federalAdditionalAmount" required data-parsley-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" data-parsley-type="number" data-parsley-group="wizard-step-3" />
											</div>
										</div>

									</div>
									<div class="row">
										<div class="col-sm-3">
											<div class="form-group">
												<label>State</label>
												<div>
													<select id="state" class="form-control" ng-model="selected.state.state" ng-options="st.stateName for st in data.companyStates track by st.stateId" required data-parsley-group="wizard-step-3"></select>
												</div>
											</div>
										</div>
										<div class="col-sm-3">
											<div class="form-group">
												<label>State Filing Status</label>
												<select ng-model="selected.state.taxStatus" name="sstatus" class="form-control" required data-parsley-group="wizard-step-3" convert-to-number data-parsley-type="number">
													<option value="1">Single</option>
													<option value="2">Married</option>
													<option value="3">Unmarried Head of Household</option>
												</select>
											</div>

										</div>
										<div class="col-sm-3">
											<div class="form-group">
												<label>Exemptions</label>
												<select ng-model="selected.state.exemptions" name="fstatus" class="form-control" required data-parsley-group="wizard-step-3" convert-to-number data-parsley-type="number">
													<option value="0">0</option>
													<option value="1">1</option>
													<option value="2">2</option>
													<option value="3">3</option>
													<option value="4">4</option>
													<option value="5">5</option>
													<option value="6">6</option>
													<option value="7">7</option>
													<option value="8">8</option>
													<option value="9">9</option>
													<option value="10">10 or more</option>
												</select>
											</div>

										</div>
										<div class="col-sm-3">
											<div class="form-group">
												<label>Additional Amout</label>
												<input name="addamount" placeholder="Federal Additional Amount" class="form-control" ng-model="selected.state.additionalAmount" required data-parsley-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" data-parsley-type="number" data-parsley-group="wizard-step-3" />
											</div>

										</div>
									</div>
									<!-- end row -->
								</fieldset>


							</div>

						</div>
						<div class="col-sm-4 col-sm-offset-4" ng-show="showControls">
							<button class="btn btn-primary" ng-click="save()" ng-disabled="!validate()"><i class="fa fa-save m-r-5"></i> Save</button>
							<button class="btn btn-default" ng-click="cancel()"><i class="fa fa-remove m-r-5"></i> Cancel</button>
						</div>
					</form>
				</div>
				<div class="tab-pane fade in" id="versions" ng-if="selected.id && tab===6" ng-class="{'active':tab===6}">
					<memento-list main-data="mainData" source-type-id="data.sourceTypeId" memento-id="selected.id" heading="'Employee Versions'" />
				</div>
			</div>
		</div>



		<div class="panel panel-inverse overflow-hidden" ng-if="selected.id && !isPopup && data.employeeMetaData">
			<div class="panel-heading">
				<h3 class="panel-title">
					<a class="accordion-toggle accordion-toggle-styled collapsed" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo">
						<i class="fa fa-plus-circle pull-right"></i>Employee Deductions
					</a>
				</h3>
			</div>
			<div id="collapseTwo" class="panel-collapse collapse">
				<div class="panel-body">
					<employee-deduction-list list="selected.deductions" employee-id="selected.id" company-deductions="mainData.selectedCompany.deductions" save-to-server="true" show-controls="showControls" agencies="data.employeeMetaData.agencies" />
				</div>
			</div>
		</div>
		
		<div class="panel panel-inverse overflow-hidden" ng-if="selected.id">
			<div class="panel-heading">
				<h3 class="panel-title">
					<a class="accordion-toggle accordion-toggle-styled collapsed" data-toggle="collapse" data-parent="#accordion" data-target="#collapseThree">
						<i class="fa fa-plus-circle pull-right"></i>
						Accumulations
					</a>
				</h3>
			</div>
			<div id="collapseThree" class="panel-collapse collapse">
				<div class="panel-body">
					<div class="row" ng-if="selected.accumulations.length===0">
						no records found
					</div>
					<table class="table table-bordered table-condensed" ng-if="selected.accumulations.length>0">
						<tr>
							<th colspan="8" class="text-center">Accumulated Pay Types</th>
						</tr>
						<tr>
							<th class="text-center">Type</th>
							<th class="text-center">Cycle</th>
							<th class="text-center">YTD Used</th>
							<th class="text-center">YTD Accumulation</th>
							<th class="text-center">Carry Over</th>
							<th class="text-center">Available</th>
							<th class="text-center">Available $</th>
							<th class="text-center" ng-show=" mainData.userRole==='Master' || mainData.userRole==='SuperUser'"></th>
						</tr>
						<tr ng-repeat="pt in selected.accumulations track by $index">
							<td class="text-right">{{pt.payTypeName}}</td>
							<td ng-show="!selectedAccumulation || selectedAccumulationIndex!==$index">{{pt.fiscalStart | date:'MM/dd/yyyy'}} - {{pt.fiscalEnd | date:'MM/dd/yyyy'}}</td>
							<td ng-show="selectedAccumulation && selectedAccumulationIndex===$index">
								<div class="col-sm-12">
									<div class="col-sm-5"><date-ctrl name="fsd" required="true" model="pt.newFiscalStart" disabled="false" /></div>
									<div class="col-sm-2 text-center">-</div>
									<div class="col-sm-5"><date-ctrl name="fse" required="true" model="pt.newFiscalEnd" disabled="false" /></div>	
								</div>
								
							</td>
							<td class="text-right">{{pt.ytdUsed}}</td>
							<td class="text-right">{{pt.ytdFiscal}}</td>
							<td class="text-right" ng-show="!selectedAccumulation || selectedAccumulationIndex!==$index">{{pt.carryOver}}</td>
							<td class="text-right" ng-show="selectedAccumulation && selectedAccumulationIndex===$index"><input name="cao" class="form-control" ng-model="pt.carryOver" required data-parsley-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" data-parsley-type="number" convert-to-decimal/></td>
							<td class="text-right">{{pt.available}}</td>
							<td class="text-right">{{calculateAvailableWage(pt) | currency:'$'}}</td>
							<td ng-show=" mainData.userRole==='Master' || mainData.userRole==='SuperUser'">
								<button class="btn btn-sm btn-primary" ng-show="!selectedAccumulation" ng-click="setSelectedAccumulation(pt, $index)"><i class="fa fa-pencil"></i></button>
								<button class="btn btn-sm btn-success" ng-show="selectedAccumulation && selectedAccumulationIndex===$index" ng-click="saveEmployeeAccumulation(pt)"><i class="fa fa-save"></i></button>
								<button class="btn btn-sm btn-default" ng-show="selectedAccumulation && selectedAccumulationIndex===$index" ng-click="cancelAccumulation(pt)"><i class="fa fa-remove"></i></button>
							</td>
						</tr>

					</table>
				</div>
			</div>
		</div>
	</div>
	<script type="text/ng-template" id="popover/ssnlist.html">

		<div class="modal-header">
			<h2 class="modal-title">SSN Details</h2>
		</div>
		<div class="modal-body">
			<div class="row">
				<table class="table table-bordered table-condensed" ng-show="list.length>0">
					<thead>
						<tr>
							<th>Host</th>
							<th>Company</th>
							<th>Name</th>
							
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="ctx in list track by $index">
							<td>
								{{ctx.host}}
							</td>
							<td>
								{{ctx.company}}
							</td>
							<td>
								{{ctx.name}}
							</td>
							
						</tr>
					</tbody>
				</table>
				<span ng-show="list.length===0">No results found</span>
			</div>
			
		</div>
		<div class="modal-footer">
			<button class="btn btn-xs btn-default" ng-click="cancel()">close</button>
		</div>
		
	</script>
	
</div>
