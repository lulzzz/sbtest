update Country set data='{
	"countryId" : 1,
	"countryName" : "USA",
	"states":  [{
		"stateId" : 1,
		"stateName" : "California",
		"abbreviation" : "CA",
		"taxesEnabled": true
	},{
		"stateId" : 2,
		"stateName" : "Alaska",
		"abbreviation" : "AK",
		"taxesEnabled": false
	},{
		"stateId" : 3,
		"stateName" : "Arizona",
		"abbreviation" : "AZ",
		"taxesEnabled": false
	}
	,{
		"stateId" : 4,
		"stateName" : "Arkansas",
		"abbreviation" : "AR",
		"taxesEnabled": false
	}
	,{
		"stateId" : 5,
		"stateName" : "Colorado",
		"abbreviation" : "CO",
		"taxesEnabled": false
	}
	,{
		"stateId" : 6,
		"stateName" : "Connecticut",
		"abbreviation" : "CT",
		"taxesEnabled": false
	}
	,{
		"stateId" : 7,
		"stateName" : "Delaware",
		"abbreviation" : "DE",
		"taxesEnabled": false
	}
	,{
		"stateId" : 8,
		"stateName" : "Florida",
		"abbreviation" : "FL",
		"taxesEnabled": false
	}
	,{
		"stateId" : 9,
		"stateName" : "Georgia",
		"abbreviation" : "GA",
		"taxesEnabled": false
	}
	,{
		"stateId" : 10,
		"stateName" : "Hawaii",
		"abbreviation" : "HI",
		"taxesEnabled": false
	},{
		"stateId" : 11,
		"stateName" : "Idaho",
		"abbreviation" : "ID",
		"taxesEnabled": false
	},{
		"stateId" : 12,
		"stateName" : "Illinois",
		"abbreviation" : "IL",
		"taxesEnabled": false
	},{
		"stateId" : 13,
		"stateName" : "Indiana",
		"abbreviation" : "IN",
		"taxesEnabled": false
	}
	,{
		"stateId" : 14,
		"stateName" : "Iowa",
		"abbreviation" : "IA",
		"taxesEnabled": false
	}
	,{
		"stateId" : 15,
		"stateName" : "Kansas",
		"abbreviation" : "KS",
		"taxesEnabled": false
	}
	,{
		"stateId" : 16,
		"stateName" : "Kentucky",
		"abbreviation" : "KY",
		"taxesEnabled": false
	}
	,{
		"stateId" : 17,
		"stateName" : "Louisiana",
		"abbreviation" : "LA",
		"taxesEnabled": false
	}
	,{
		"stateId" : 18,
		"stateName" : "Maine",
		"abbreviation" : "ME",
		"taxesEnabled": false
	}
	,{
		"stateId" : 19,
		"stateName" : "Maryland",
		"abbreviation" : "MD",
		"taxesEnabled": false
	}
	,{
		"stateId" : 20,
		"stateName" : "Massachusetts",
		"abbreviation" : "MA",
		"taxesEnabled": false
	},{
		"stateId" : 21,
		"stateName" : "Michigan",
		"abbreviation" : "MI",
		"taxesEnabled": false
	},{
		"stateId" : 22,
		"stateName" : "Minnesota",
		"abbreviation" : "MN",
		"taxesEnabled": false
	},{
		"stateId" : 23,
		"stateName" : "Mississippi",
		"abbreviation" : "MS",
		"taxesEnabled": false
	}
	,{
		"stateId" : 24,
		"stateName" : "Missouri",
		"abbreviation" : "MO",
		"taxesEnabled": false
	}
	,{
		"stateId" : 25,
		"stateName" : "Montana",
		"abbreviation" : "MT",
		"taxesEnabled": false
	}
	,{
		"stateId" : 26,
		"stateName" : "Nebraska",
		"abbreviation" : "NE",
		"taxesEnabled": false
	}
	,{
		"stateId" : 27,
		"stateName" : "Nevada",
		"abbreviation" : "NV",
		"taxesEnabled": false
	}
	,{
		"stateId" : 28,
		"stateName" : "New Hampshire",
		"abbreviation" : "NH",
		"taxesEnabled": false
	}
	,{
		"stateId" : 29,
		"stateName" : "New Jersey",
		"abbreviation" : "NJ",
		"taxesEnabled": false
	}
	,{
		"stateId" : 30,
		"stateName" : "New Mexico",
		"abbreviation" : "NM",
		"taxesEnabled": false
	},{
		"stateId" : 31,
		"stateName" : "New York",
		"abbreviation" : "NY",
		"taxesEnabled": false
	},{
		"stateId" : 32,
		"stateName" : "North Carolina",
		"abbreviation" : "NC",
		"taxesEnabled": false
	},{
		"stateId" : 33,
		"stateName" : "North Dakota",
		"abbreviation" : "ND",
		"taxesEnabled": false
	}
	,{
		"stateId" : 34,
		"stateName" : "Ohio",
		"abbreviation" : "OH",
		"taxesEnabled": false
	}
	,{
		"stateId" : 35,
		"stateName" : "Oklahoma",
		"abbreviation" : "OK",
		"taxesEnabled": false
	}
	,{
		"stateId" : 36,
		"stateName" : "Oregon",
		"abbreviation" : "OR",
		"taxesEnabled": false
	}
	,{
		"stateId" : 37,
		"stateName" : "Pennsylvania",
		"abbreviation" : "PA",
		"taxesEnabled": false
	}
	,{
		"stateId" : 38,
		"stateName" : "Rhode Island",
		"abbreviation" : "RI",
		"taxesEnabled": false
	}
	,{
		"stateId" : 39,
		"stateName" : "South Carolina",
		"abbreviation" : "SC",
		"taxesEnabled": false
	}
	,{
		"stateId" : 40,
		"stateName" : "South Dakota",
		"abbreviation" : "SD",
		"taxesEnabled": false
	},{
		"stateId" : 41,
		"stateName" : "Tennessee",
		"abbreviation" : "TN",
		"taxesEnabled": false
	},{
		"stateId" : 42,
		"stateName" : "Texas",
		"abbreviation" : "TX",
		"taxesEnabled": false
	},{
		"stateId" : 43,
		"stateName" : "Utah",
		"abbreviation" : "UT",
		"taxesEnabled": false
	}
	,{
		"stateId" : 44,
		"stateName" : "Vermont",
		"abbreviation" : "VT",
		"taxesEnabled": false
	}
	,{
		"stateId" : 45,
		"stateName" : "Virginia",
		"abbreviation" : "VA",
		"taxesEnabled": false
	}
	,{
		"stateId" : 46,
		"stateName" : "Washington",
		"abbreviation" : "WA",
		"taxesEnabled": false
	}
	,{
		"stateId" : 47,
		"stateName" : "Washington, DC",
		"abbreviation" : "DC",
		"taxesEnabled": false
	}
	,{
		"stateId" : 48,
		"stateName" : "West Virginia",
		"abbreviation" : "WV",
		"taxesEnabled": false
	}
	,{
		"stateId" : 49,
		"stateName" : "Wisconsin",
		"abbreviation" : "WI",
		"taxesEnabled": false
	}
	,{
		"stateId" : 50,
		"stateName" : "Wyoming",
		"abbreviation" : "WY",
		"taxesEnabled": false
	}
	]
}' where CountryId=1;

/****** Object:  StoredProcedure [dbo].[GetPayrolls]    Script Date: 8/03/2017 7:17:56 PM ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetPayrolls]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[GetPayrolls]
GO
/****** Object:  StoredProcedure [dbo].[GetPayrolls]    Script Date: 8/03/2017 7:17:56 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetPayrolls]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[GetPayrolls] AS' 
END
GO
ALTER PROCEDURE [dbo].[GetPayrolls]
	@company varchar(max) = null,
	@startdate varchar(max) = null,
	@enddate varchar(max) = null,
	@id uniqueidentifier=null,
	@invoice uniqueidentifier=null,
	@status varchar(max)=null,
	@void int=null
AS
BEGIN
	if exists(select 'x' from Payroll left outer join  PayrollInvoice Pinv on Payroll.Id=Pinv.PayrollId where 
		((@void is null) or (@void is not null and exists(select 'x' from PayrollPayCheck where PayrollId=Payroll.Id and IsVoid=0)))
		and ((@invoice is not null and cast(@invoice as uniqueidentifier)=Pinv.Id) or (@invoice is null))
		and ((@id is not null and Payroll.Id=@id) or (@id is null)) 
		and ((@company is not null and Payroll.CompanyId=@company) or (@company is null)) 
		and ((@startdate is not null and PayDay>=@startdate) or (@startdate is null)) 
		and ((@enddate is not null and PayDay<=@enddate) or (@enddate is null)) 
		and ((@status is not null and Payroll.Status=cast(@status as int)) or @status is null)
		)
	select
		Payroll.*,
		Pinv.Id as InvoiceId,
		Pinv.Total, Pinv.InvoiceNumber, Pinv.Status as InvoiceStatus,
		
		(select PayrollPayCheck.*, Journal.DocumentId DocumentId from PayrollPayCheck, Journal where PayrollPayCheck.Id=Journal.PayrollPayCheckId and PayrollPayCheck.PEOASOCoCheck=Journal.PEOASOCoCheck and PayrollPayCheck.PayrollId=Payroll.Id Order by PayrollPayCheck.Id for Xml path('PayrollPayCheckJson'), Elements, type) PayrollPayChecks
		from Payroll left outer join  PayrollInvoice Pinv on Payroll.Id=Pinv.PayrollId
		Where
		((@void is null) or (@void is not null and exists(select 'x' from PayrollPayCheck where PayrollId=Payroll.Id and IsVoid=0)))
		and ((@invoice is not null and cast(@invoice as uniqueidentifier)=Pinv.Id) or (@invoice is null))
		and ((@id is not null and Payroll.Id=@id) or (@id is null)) 
		and ((@company is not null and Payroll.CompanyId=@company) or (@company is null)) 
		and ((@startdate is not null and PayDay>=@startdate) or (@startdate is null)) 
		and ((@enddate is not null and PayDay<=@enddate) or (@enddate is null)) 
		and ((@status is not null and Payroll.Status=cast(@status as int)) or @status is null)
		Order by PayDay
		for Xml path('PayrollJson'), root('PayrollList'), elements, type
	else
		begin
			if @company is not null
				select
				top(1) Payroll.*,
				Pinv.Id as InvoiceId,
				Pinv.Total, Pinv.InvoiceNumber, Pinv.Status as InvoiceStatus,
		
				(select PayrollPayCheck.*, Journal.DocumentId DocumentId from PayrollPayCheck, Journal where PayrollPayCheck.Id=Journal.PayrollPayCheckId and PayrollPayCheck.PEOASOCoCheck=Journal.PEOASOCoCheck and PayrollPayCheck.PayrollId=Payroll.Id Order by PayrollPayCheck.Id for Xml path('PayrollPayCheckJson'), Elements, type) PayrollPayChecks
				from Payroll left outer join  PayrollInvoice Pinv on Payroll.Id=Pinv.PayrollId
				Where				
				((@company is not null and Payroll.CompanyId=@company) or (@company is null)) 
				Order by PayDay desc
				for Xml path('PayrollJson'), root('PayrollList'), elements, type
			else
				select * from Payroll where status='' for Xml path('PayrollJson'), root('PayrollList'), elements, type;
			
		end
		
	
	
END
GO
